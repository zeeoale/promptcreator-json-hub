<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>JSON Prompt Creator Hub</title>
  <style>
    :root{--bg:#0b0b0d;--card:#111114;--border:rgba(255,255,255,.08);--txt:rgba(231,231,234,.92)}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; }
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    h1{font-size:28px;margin:0 0 16px}
    .toolbar{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 18px}
    input{flex:1;min-width:240px;background:#0f0f12;border:1px solid var(--border);color:var(--txt);padding:10px 12px;border-radius:10px;outline:none}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
    .thumb{aspect-ratio:4/3;background:#0f0f12;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .body{padding:12px}
    .name{font-weight:700;margin:0 0 6px;font-size:14px}
    .meta{opacity:.78;font-size:12px;margin:0 0 10px;line-height:1.3}
    .logo{max-width:220px;width: 100% }
    .tags{display:flex;flex-wrap:wrap;gap:6px}
    .tag{font-size:11px;color:rgba(231,231,234,.78);border:1px solid var(--border);
      padding:4px 8px;border-radius:999px;background:rgba(0,0,0,.15);
      text-decoration:none;display:inline-flex;align-items:center}
    .tag:hover{border-color:rgba(139,92,246,.35);color:rgba(231,231,234,.95)}
    .small{opacity:.7;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <img src="JSON_HUB_LOGO.png" class="logo">
    <div class="toolbar">
      <input id="q" placeholder="Cerca per nome, autore, descrizione o tag…">
      <div class="small" id="status"></div>
    </div>
    <div class="grid" id="grid"></div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);
  const qs = new URLSearchParams(location.search);
  const tagParam = (qs.get("tag")||"").trim().toLowerCase();

  function hasTag(item, t){
    return (item.tags||[]).some(x => (x||"").toLowerCase() === t);
  }

  function matchText(item, q){
    q = q.toLowerCase();
    const hay = [
      item.name, item.author, item.description,
      ...(item.tags||[])
    ].join(" ").toLowerCase();
    return hay.includes(q);
  }

  function render(items){
    const grid = $("grid");
    grid.innerHTML = "";
    items.forEach(it=>{
      const c = document.createElement("div");
      c.className="card";

      const thumb = document.createElement("div");
      thumb.className="thumb";

      if(it.preview){
        const img=document.createElement("img");
        img.loading="lazy";
        img.src=it.preview; // <-- RELATIVO: previews/xxx.png
        thumb.appendChild(img);
      } else {
        thumb.textContent="(no preview)";
      }

      const b = document.createElement("div");
      b.className="body";

      const raw = it.file; // <-- RELATIVO: json/xxx.json

      b.innerHTML = `
        <div class="name">${it.name}</div>
        <div class="meta"><b>Author:</b> ${it.author||"-"}<br>${it.description||""}</div>
        <div class="meta">
          <a class="tag" href="${raw}" target="_blank" rel="noopener">download json</a>
        </div>
      `;

      const tags = document.createElement("div");
      tags.className="tags";
      (it.tags||[]).slice(0,12).forEach(t=>{
        const a = document.createElement("a");
        a.className="tag";
        a.textContent=t;
        a.href=`?tag=${encodeURIComponent(t)}`;
        tags.appendChild(a);
      });

      b.appendChild(tags);
      c.appendChild(thumb);
      c.appendChild(b);
      grid.appendChild(c);
    });
  }

  async function main(){
    const res = await fetch("index.json", {cache:"no-store"}); // index.json in docs/
    const data = await res.json();
    let items = data.items || [];

    if(tagParam){
      items = items.filter(x => hasTag(x, tagParam));
    }

    const qEl = $("q");
    const apply = ()=>{
      const q = (qEl.value||"").trim();
      const out = q ? items.filter(x => matchText(x,q)) : items;
      render(out);
      $("status").textContent =
        `Mostro ${out.length} / ${data.items.length} — ${tagParam ? `tag: ${tagParam}` : "tutti"}`;
    };

    qEl.addEventListener("input", apply);
    apply();
  }
  main();
</script>

</body>
</html>
